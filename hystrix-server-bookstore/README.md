###  使用Ribbon和SpringCloud实现客户端负载均衡-使用熔断器防止服务雪崩 
####  1、介绍 
Spring cloud使用Hystrix组件实现服务的熔断，防止因某个服务出现故障，导致服务级联调用而引发雪崩问题。    

1.1 雪崩效应    
在微服务架构中通常会有多个服务层调用，基础服务的故障可能会导致级联故障，进而造成整个系统不可用的情 况，这种现象被称为服务雪崩效应。服务雪崩效应是一种因“服务提供者”的不可用导致“服务消费者”的不可 用,并将不可用逐渐放大的过程。     
比如：A作为服务提供者，B为A的服务消费者，C和D是B的服务消费者。A不可用引起了B的不可用，并 将不可用像滚雪球一样放大到C和D时，雪崩效应就形成了。   

1.2 熔断器 
CircuitBreaker，熔断器的原理很简单，如同电力过载保护器。它可以实现快速失败，如果它在一段时间内侦测到 许多类似的错误，会强迫其以后的多个调用快速失败，不再访问远程服务器，从而防止应用程序不断地尝试执行可 能会失败的操作，使得应用程序继续执行而不用等待修正错误，或者浪费CPU时间去等到长时间的超时产生。熔断 器也可以使应用程序能够诊断错误是否已经修正，如果已经修正，应用程序会再次尝试调用操作。      
熔断器模式就像是那些容易导致错误的操作的一种代理。这种代理能够记录最近调用发生错误的次数，然后决定使 用允许操作继续，或者立即返回错误。熔断器就是保护服务高可用的最后一道防线。     


####  2、hystrix熔断 
2.1 熔断机制     
断路器很好理解, 当Hystrix Command请求后端服务失败数量超过一定比例(默认50%), 断路器会切换到开路状态 (Open).      
这时所有请求会直接失败而不会发送到后端服务. 断路器保持在开路状态一段时间后(默认5秒), 自动切换 到半开路状态(HALF-OPEN).      
这时会判断下一次请求的返回情况, 如果请求成功, 断路器切回闭路状态(CLOSED), 否 则重新切换到开路状态(OPEN). Hystrix的断路器就像我们家庭电路中的保险丝, 一旦后端服务不可用, 断路器会直接 切断请求链, 避免发送大量无效请求影响系统吞吐量, 并且断路器有自我检测并恢复的能力.     

2.2 熔断模式说明    
Netflix的Hystrix库提供了熔断模式的实现：当对方法进行熔断处理时， Hystrix 会监控方法的失败调用，如果失败 次数达到阈值，Hystrix就打开熔断以致后续访问自动失败。熔断开启后，Hystrix把对方法的调用重定向到特定回调方法中。     
Spring Cloud Netflix Hystrix会查找加了@HystrixCommand注解的方法，并使用代理模式对该方法进行包装，该 代理会连接到熔断器以便Hystrix能够监控。当前只对标记了@Component和@Service注解的类有效。      

